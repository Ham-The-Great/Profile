<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Car HUD</title>
  <style>
    body {
      background: black;
      color: lime;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
      transform: scaleX(-1); /* Flip horizontally for HUD reflection */
    }
    #hud {
      text-align: center;
    }
    .speed, .gps {
      font-size: 3rem;
      margin: 10px;
    }
    #map {
      width: 100%;
      height: 50vh;
    }
  </style>
</head>
<body>
  <div id="hud">
    <div class="speed">Speed: <span id="speed">0</span> km/h</div>
    <div class="gps">GPS: <span id="location">Searching...</span></div>
    <div id="map"></div>
  </div>
  <script>
    // Real-Time Speed Calculation
    let lastCoords = null;
    navigator.geolocation.watchPosition(
      (position) => {
        const { latitude, longitude, speed } = position.coords;

        // If the speed is provided by the device
        if (speed !== null && !isNaN(speed)) {
          document.getElementById('speed').textContent = (speed * 3.6).toFixed(2); // Convert m/s to km/h
        } else {
          // Calculate speed using distance and time from two points
          const currentCoords = { lat: latitude, lng: longitude, time: Date.now() };
          if (lastCoords) {
            const distance = calculateDistance(
              lastCoords.lat,
              lastCoords.lng,
              currentCoords.lat,
              currentCoords.lng
            ); // Distance in km
            const timeElapsed = (currentCoords.time - lastCoords.time) / (1000 * 60 * 60); // Time in hours
            const calculatedSpeed = distance / timeElapsed;
            document.getElementById('speed').textContent = calculatedSpeed.toFixed(2);
          }
          lastCoords = currentCoords;
        }
        document.getElementById('location').textContent = `${latitude.toFixed(2)}, ${longitude.toFixed(2)}`;
      },
      () => {
        document.getElementById('location').textContent = 'Unable to retrieve location';
      }
    );

    function calculateDistance(lat1, lon1, lat2, lon2) {
      const R = 6371; // Earth's radius in km
      const dLat = ((lat2 - lat1) * Math.PI) / 180;
      const dLon = ((lon2 - lon1) * Math.PI) / 180;
      const a =
        Math.sin(dLat / 2) * Math.sin(dLat / 2) +
        Math.cos((lat1 * Math.PI) / 180) *
          Math.cos((lat2 * Math.PI) / 180) *
          Math.sin(dLon / 2) *
          Math.sin(dLon / 2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
      return R * c; // Distance in km
    }

    // Driving View Map using Leaflet.js
    const script = document.createElement('script');
    script.src = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.js';
    script.onload = () => {
      const map = L.map('map').setView([51.505, -0.09], 15);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Map data Â© <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors',
      }).addTo(map);
      navigator.geolocation.watchPosition((pos) => {
        const { latitude, longitude } = pos.coords;
        map.setView([latitude, longitude], 15);
      });
    };
    document.head.appendChild(script);
  </script>
</body>
</html>
